{"version":3,"file":"s3-BdyB1uLY.js","sources":["../../../.svelte-kit/adapter-node/chunks/s3.js"],"sourcesContent":["import { S3Client, GetObjectCommand } from \"@aws-sdk/client-s3\";\nimport { l as logger } from \"./index.js\";\nconst BUCKET = process.env.S3_CONTENT_BUCKET;\nconst contentCache = /* @__PURE__ */ new Map();\nconst CACHE_TTL = 5 * 60 * 1e3;\nconst s3 = new S3Client({\n  region: process.env.AWS_REGION || \"us-east-1\"\n});\nasync function getPageContentFromS3(pageKey) {\n  const cached = contentCache.get(pageKey);\n  if (cached && cached.expires > Date.now()) {\n    logger.info(`[Cache HIT] ${pageKey}`);\n    return cached.data;\n  }\n  logger.info(`[Cache MISS] Fetching ${pageKey} from S3`);\n  try {\n    const command = new GetObjectCommand({\n      Bucket: BUCKET,\n      Key: `pages/${pageKey}.json`\n    });\n    const response = await s3.send(command);\n    const bodyString = await response.Body?.transformToString();\n    if (!bodyString) {\n      throw new Error(`Empty response for ${pageKey}`);\n    }\n    const content = JSON.parse(bodyString);\n    contentCache.set(pageKey, {\n      data: content,\n      expires: Date.now() + CACHE_TTL\n    });\n    return content;\n  } catch (error) {\n    logger.error(`Failed to fetch ${pageKey} from S3:`, error);\n    if (cached) {\n      logger.info(`[Fallback] Using stale cache for ${pageKey}`);\n      return cached.data;\n    }\n    throw error;\n  }\n}\nexport {\n  getPageContentFromS3 as g\n};\n"],"names":[],"mappings":";;;AAEA,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,iBAAiB;AAC5C,MAAM,YAAY,mBAAmB,IAAI,GAAG,EAAE;AAC9C,MAAM,SAAS,GAAG,CAAC,GAAG,EAAE,GAAG,GAAG;AAC9B,MAAM,EAAE,GAAG,IAAI,QAAQ,CAAC;AACxB,EAAE,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU,IAAI;AACpC,CAAC,CAAC;AACF,eAAe,oBAAoB,CAAC,OAAO,EAAE;AAC7C,EAAE,MAAM,MAAM,GAAG,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC;AAC1C,EAAE,IAAI,MAAM,IAAI,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,GAAG,EAAE,EAAE;AAC7C,IAAI,MAAM,CAAC,IAAI,CAAC,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC,CAAC;AACzC,IAAI,OAAO,MAAM,CAAC,IAAI;AACtB,EAAE;AACF,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,sBAAsB,EAAE,OAAO,CAAC,QAAQ,CAAC,CAAC;AACzD,EAAE,IAAI;AACN,IAAI,MAAM,OAAO,GAAG,IAAI,gBAAgB,CAAC;AACzC,MAAM,MAAM,EAAE,MAAM;AACpB,MAAM,GAAG,EAAE,CAAC,MAAM,EAAE,OAAO,CAAC,KAAK;AACjC,KAAK,CAAC;AACN,IAAI,MAAM,QAAQ,GAAG,MAAM,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC;AAC3C,IAAI,MAAM,UAAU,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,iBAAiB,EAAE;AAC/D,IAAI,IAAI,CAAC,UAAU,EAAE;AACrB,MAAM,MAAM,IAAI,KAAK,CAAC,CAAC,mBAAmB,EAAE,OAAO,CAAC,CAAC,CAAC;AACtD,IAAI;AACJ,IAAI,MAAM,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;AAC1C,IAAI,YAAY,CAAC,GAAG,CAAC,OAAO,EAAE;AAC9B,MAAM,IAAI,EAAE,OAAO;AACnB,MAAM,OAAO,EAAE,IAAI,CAAC,GAAG,EAAE,GAAG;AAC5B,KAAK,CAAC;AACN,IAAI,OAAO,OAAO;AAClB,EAAE,CAAC,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC,gBAAgB,EAAE,OAAO,CAAC,SAAS,CAAC,EAAE,KAAK,CAAC;AAC9D,IAAI,IAAI,MAAM,EAAE;AAChB,MAAM,MAAM,CAAC,IAAI,CAAC,CAAC,iCAAiC,EAAE,OAAO,CAAC,CAAC,CAAC;AAChE,MAAM,OAAO,MAAM,CAAC,IAAI;AACxB,IAAI;AACJ,IAAI,MAAM,KAAK;AACf,EAAE;AACF;;;;"}