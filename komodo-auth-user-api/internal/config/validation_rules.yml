#  ____        _        ____             __ _       
# |  _ \ _   _| | ___  / ___|___  _ __  / _(_) __ _ 
# | |_) | | | | |/ _ \| |   / _ \| '_ \| |_| |/ _` |
# |  _ <| |_| | |  __/| |__| (_) | | | |  _| | (_| |
# |_| \_\\__,_|_|\___| \____\___/|_| |_|_| |_|\__, |
#                                             |___/ 
#
# Validation Levels: ignore | lenient | strict
# Public Routes: No Cookie/CSRF required
# Protected Routes: Require Cookie + X-CSRF-Token + Idempotency-Key
#

rules:
  "/health":
    GET:
      level: "ignore"
  "/auth/login":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "User-Agent":
          required: true
          type: "string"
      body:
        "email":
          required: true
          type: "string"
        "password":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/logout":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Authorization":
          required: true
          type: "string"
          pattern: "^Bearer\\s+[A-Za-z0-9\\-_\\.]+$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "Idempotency-Key":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/register":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "User-Agent":
          required: true
          type: "string"
      body:
        "email":
          required: true
          type: "string"
        "password":
          required: true
          type: "string"
        "name":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/password/reset":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "User-Agent":
          required: true
          type: "string"
      body:
        "email":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/password/reset/:token":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "User-Agent":
          required: true
          type: "string"
      pathParams:
        "token":
          required: true
          type: "string"
      body:
        "password":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/passkey/login":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "User-Agent":
          required: true
          type: "string"
      body:
        "email":
          required: false
          type: "string"
      requiredVersion: 1
  "/auth/passkey/login/verify":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "User-Agent":
          required: true
          type: "string"
      body:
        "challenge":
          required: true
          type: "string"
        "credential_response":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/me":
    GET:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      requiredVersion: 1
    PATCH:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "Idempotency-Key":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      body:
        "name":
          required: false
          type: "string"
        "phone":
          required: false
          type: "string"
      requiredVersion: 1
  "/auth/sessions":
    GET:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/sessions/:id":
    DELETE:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "Idempotency-Key":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      pathParams:
        "id":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/mfa/setup":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "Idempotency-Key":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/mfa/enable":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "Idempotency-Key":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      body:
        "verification_code":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/mfa/disable":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "Idempotency-Key":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      body:
        "password":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/mfa/verify":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "User-Agent":
          required: true
          type: "string"
      body:
        "verification_code":
          required: true
          type: "string"
        "login_challenge_token":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/passkey/register":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "Idempotency-Key":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      requiredVersion: 1
  "/auth/passkey/register/verify":
    POST:
      level: "strict"
      headers:
        "Accept":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Content-Type":
          required: true
          type: "string"
          pattern: "^application/json(;\\s*(v|version)=\\d+)?$"
        "Cookie":
          required: true
          type: "string"
        "X-CSRF-Token":
          required: true
          type: "string"
        "Idempotency-Key":
          required: true
          type: "string"
        "User-Agent":
          required: true
          type: "string"
      body:
        "challenge":
          required: true
          type: "string"
        "credential_response":
          required: true
          type: "string"
      requiredVersion: 1
